{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<section class="page-card p-4 mb-4">
  <h1 class="section-title mb-1">Dashboard</h1>
  <p class="section-subtitle mb-0">Track active bookings separately from past booking history.</p>
</section>

<section class="metric-grid mb-4">
  <article class="metric-card">
    <p class="text-muted mb-1">Upcoming bookings you made</p>
    <h2 class="h4 mb-0">{{ cos_bookings|length }}</h2>
  </article>
  <article class="metric-card">
    <p class="text-muted mb-1">Upcoming requests as chef</p>
    <h2 class="h4 mb-0">{{ bookings|length }}</h2>
  </article>
  <article class="metric-card">
    <p class="text-muted mb-1">Pending requests</p>
    <h2 class="h4 mb-0">{{ pending_count }}</h2>
  </article>
</section>

<section class="page-card p-4 mb-4">
  <h2 class="h5 mb-3">Upcoming requests received as chef</h2>
  {% if bookings %}
  <div class="data-table-wrap">
    <table class="table table-hover align-middle">
      <thead>
        <tr>
          <th>Customer</th>
          <th>Date</th>
          <th>Time</th>
          <th>Guests</th>
          <th>Total</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for booking in bookings %}
        <tr>
          <td>{{ booking.customer.username }}</td>
          <td>{{ booking.date }}</td>
          <td>{{ booking.time }}</td>
          <td>{{ booking.person }}</td>
          <td>INR {{ booking.total_price }}</td>
          <td>
            {% if booking.status == "Pending" %}
            <span class="status-pill status-pending">Pending</span>
            {% elif booking.status == "Accepted" %}
            <span class="status-pill status-accepted">Accepted</span>
            {% else %}
            <span class="status-pill status-rejected">Rejected</span>
            {% endif %}
          </td>
          <td>
            {% if booking.status == "Pending" %}
            <a href="{% url 'update_booking_status' booking.id 'Accepted' %}" class="btn btn-sm btn-primary">Accept</a>
            <a href="{% url 'update_booking_status' booking.id 'Rejected' %}" class="btn btn-sm btn-outline-danger ms-1">Reject</a>
            {% else %}
            <span class="text-muted">No action</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <p class="mb-0">No upcoming requests are assigned to your chef profile.</p>
  {% endif %}
</section>

<section class="page-card p-4 mb-4">
  <h2 class="h5 mb-3">Past requests received as chef</h2>
  {% if past_bookings %}
  <div class="data-table-wrap">
    <table class="table table-hover align-middle">
      <thead>
        <tr>
          <th>Customer</th>
          <th>Date</th>
          <th>Time</th>
          <th>Guests</th>
          <th>Total</th>
          <th>Status</th>
          <th>Tag</th>
        </tr>
      </thead>
      <tbody>
        {% for booking in past_bookings %}
        <tr>
          <td>{{ booking.customer.username }}</td>
          <td>{{ booking.date }}</td>
          <td>{{ booking.time }}</td>
          <td>{{ booking.person }}</td>
          <td>INR {{ booking.total_price }}</td>
          <td>{{ booking.status }}</td>
          <td><span class="status-pill status-rejected">Past</span></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <p class="mb-0">No past requests for your chef profile.</p>
  {% endif %}
</section>

<section class="page-card p-4 mb-4">
  <h2 class="h5 mb-3">Upcoming booking requests</h2>
  {% if cos_bookings %}
  <div class="data-table-wrap">
    <table class="table table-hover align-middle">
      <thead>
        <tr>
          <th>Chef</th>
          <th>Date</th>
          <th>Time</th>
          <th>Guests</th>
          <th>Total</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        {% for booking in cos_bookings %}
        <tr>
          <td>{{ booking.chef.name }}</td>
          <td>{{ booking.date }}</td>
          <td>{{ booking.time }}</td>
          <td>{{ booking.person }}</td>
          <td>INR {{ booking.total_price }}</td>
          <td>
            {% if booking.status == "Pending" %}
            <span class="status-pill status-pending">Pending</span>
            {% elif booking.status == "Accepted" %}
            <span class="status-pill status-accepted">Accepted</span>
            {% else %}
            <span class="status-pill status-rejected">Rejected</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <p class="mb-2">You have no upcoming booking requests.</p>
  <a href="{% url 'chef_list' %}" class="btn btn-primary">Browse Chefs</a>
  {% endif %}
</section>

<section class="page-card p-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="h5 mb-0">Past bookings</h2>
    {% if past_cos_bookings %}
    <form method="post" action="{% url 'clear_past_bookings' %}">
      {% csrf_token %}
      <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Remove all past bookings from your list?')">Clear Past Bookings</button>
    </form>
    {% endif %}
  </div>

  {% if past_cos_bookings %}
  <div class="data-table-wrap">
    <table class="table table-hover align-middle">
      <thead>
        <tr>
          <th>Chef</th>
          <th>Date</th>
          <th>Time</th>
          <th>Status</th>
          <th>Tag</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for booking in past_cos_bookings %}
        <tr id="past-booking-{{ booking.id }}">
          <td>{{ booking.chef.name }}</td>
          <td>{{ booking.date }}</td>
          <td>{{ booking.time }}</td>
          <td>{{ booking.status }}</td>
          <td><span class="status-pill status-rejected">Past</span></td>
          <td>
            <form method="post" action="{% url 'remove_booking' booking.id %}" class="d-inline">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('This will remove the booking from your list. Continue?')">Remove from List</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <p class="mb-0">No past bookings available.</p>
  {% endif %}
</section>
{% endblock %}
